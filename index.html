<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Subtraction Tool</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="header-container">
            <h1>حملة صلوات لروح الشهيد علي جعفر شحيمي (موسى)</h1>
        </div>
    </header>

    <div class="container">
        <h2>عدد الصلوات المطلوبة: <span id="totalNumber">1,000,000</span></h2>

        <!-- Input and Subtract button -->
        <div class="input-container">
            <input type="number" id="subtractNumber" placeholder="عدد الصلوات التي ترغب بالمشاركة بها">
            <button onclick="subtractNumber()">حفظ</button>
        </div>

        <br>
        <h2>عدد الصلوات المتبقية: <span id="remainingNumber">1,000,000</span></h2>
        <button onclick="resetNumber()">Reset</button>
    </div>

    <script>
        const webAppUrl = 'https://script.google.com/macros/s/AKfycbwxqkV8XiCMMzTFWpeIKBaZTyMEr_xAOf63DW87vBhIp7UGmjtJ5d0lSEX4960jmUhm/exec'; // Replace with your Google Apps Script URL

        const remainingNumberElement = document.getElementById('remainingNumber');
        const subtractNumberElement = document.getElementById('subtractNumber');

        // Function to fetch the total number from the server
        function fetchTotal() {
            fetch(webAppUrl)
                .then(response => response.json())
                .then(data => {
                    console.log('Fetched total:', data.total);  // Log the fetched data for debugging
                    remainingNumberElement.textContent = formatNumberWithCommas(data.total);
                })
                .catch(error => console.error('Error fetching total:', error)); // Added error handling
        }

        // Function to handle subtraction
function subtractNumber() {
    const subtractValue = parseInt(subtractNumberElement.value, 10);

    // Check if the input is a valid number and is not negative
    if (isNaN(subtractValue) || subtractValue <= 0) {
        alert("Please enter a valid number greater than 0.");
        return;
    }

    // Send the subtraction request to the backend (Google Apps Script)
    fetch(webAppUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ subtractValue: subtractValue })
    })
    .then(response => response.json())
    .then(data => {
        console.log('Updated total:', data.total);  // Log the updated total for debugging
        // Update the displayed remaining number after the response
        remainingNumberElement.textContent = formatNumberWithCommas(data.total);
    })
    .catch(error => console.error('Error subtracting:', error)); // Added error handling
}


        // Function to handle reset
        function resetNumber() {
            const userPassword = prompt("Enter the password to reset:");
            if (userPassword === "mojtaba") {
                fetch(webAppUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ subtractValue: -1000000 }) // Use a large negative value to reset
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Reset total:', data.total);  // Log the reset total for debugging
                    remainingNumberElement.textContent = formatNumberWithCommas(1000000);
                    alert("Remaining number has been reset!");
                })
                .catch(error => console.error('Error resetting:', error)); // Added error handling
            } else {
                alert("Incorrect password! Reset denied.");
            }
        }

        // Function to format the number with commas
        function formatNumberWithCommas(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Initial fetch to get the total
        fetchTotal();

        // Polling to update the total every 5 seconds
        setInterval(fetchTotal, 5000);
    </script>
</body>
</html>
